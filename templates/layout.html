
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}BeaconSEL | Lesson Generator{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #fdfdfd;
      font-family: 'Segoe UI', sans-serif;
    }
    .navbar {
      background-color: #ffd580;
    }
    .navbar-brand {
      font-weight: bold;
      font-size: 1.5rem;
    }
    footer {
      margin-top: 3rem;
      padding: 1rem 0;
      background-color: #f4f4f4;
      text-align: center;
      font-size: 0.9rem;
      color: #666;
    }
    .hover-card {
      transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }
    .hover-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
    }
  </style>
</head>
<body>

  <nav class="navbar navbar-light px-3 mb-4 shadow-sm">
    <a class="navbar-brand" href="/">ðŸŒž BeaconSEL</a>
    <a href="/dashboard" class="btn btn-outline-dark">View Dashboard</a>
  </nav>

  <div class="container">
    {% block content %}{% endblock %}
  </div>

  <footer>
    Made with ðŸ’› for teachers | BeaconSEL App
  </footer>

  <!-- Copilot Panel (starts blank, filled dynamically) -->
  <div id="copilotPanel" class="position-fixed end-0 top-0 bg-white border-start shadow p-3" 
       style="width: 320px; height: 100vh; display: none; z-index: 1040; overflow-y: auto;">
  </div>

  <!-- Copilot Toggle Button -->
  <button onclick="toggleCopilot(); fetchCopilotSuggestions();" class="btn btn-warning position-fixed bottom-0 end-0 m-4 shadow">ðŸ§  Copilot</button>

  <script>
  function toggleCopilot() {
    const panel = document.getElementById("copilotPanel");
    panel.style.display = panel.style.display === "none" ? "block" : "none";
  }

  function fetchCopilotSuggestions() {
    const gradeSelect = document.querySelector("select[name='grade']");
    const subjectSelect = document.querySelector("select[name='subject']");
    const topicInput = document.querySelector("input[name='topic']");
    const selSelect = document.querySelector("select[name='sel']");

    // Check if we're on the main page with the form
    if (!gradeSelect || !subjectSelect || !topicInput || !selSelect) {
      document.getElementById("copilotPanel").innerHTML = `
        <h5>ðŸ§  BeaconSEL Copilot</h5>
        <p class="text-muted">Go to the lesson generator to get personalized suggestions!</p>
        <button onclick="toggleCopilot()" class="btn btn-sm btn-outline-danger mt-3">Close</button>
      `;
      return;
    }

    const grade = gradeSelect.value;
    const subject = subjectSelect.value;
    const topic = topicInput.value;
    const sel = selSelect.value;

    const panel = document.getElementById("copilotPanel");
    panel.innerHTML = `
      <h5>ðŸ§  BeaconSEL Copilot</h5>
      <p class='text-muted'>Thinking about your lesson... âœ¨</p>
    `;

    // Only fetch suggestions if we have the minimum required fields
    if (!grade || !subject || !sel) {
      panel.innerHTML = `
        <h5>ðŸ§  BeaconSEL Copilot</h5>
        <p class="text-muted">Fill out the lesson form to get personalized suggestions!</p>
        <button onclick="toggleCopilot()" class="btn btn-sm btn-outline-danger mt-3">Close</button>
      `;
      return;
    }

    fetch('/copilot_suggestions', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ grade, subject, topic: topic || 'General Skills', sel })
    })
    .then(res => res.json())
    .then(data => {
      if (data.suggestions) {
        panel.innerHTML = `
          <h5>ðŸ§  BeaconSEL Copilot</h5>
          <div style="font-size: 0.9rem; line-height: 1.5;">
            <pre style="white-space: pre-wrap; font-family: inherit; margin: 0;">${data.suggestions}</pre>
          </div>
          <button onclick="toggleCopilot()" class="btn btn-sm btn-outline-danger mt-3">Close</button>
        `;
      } else {
        panel.innerHTML = `
          <h5>ðŸ§  BeaconSEL Copilot</h5>
          <p class="text-danger">Error loading suggestions. Please try again.</p>
          <button onclick="toggleCopilot()" class="btn btn-sm btn-outline-danger mt-3">Close</button>
        `;
      }
    })
    .catch(error => {
      panel.innerHTML = `
        <h5>ðŸ§  BeaconSEL Copilot</h5>
        <p class="text-danger">Connection error. Please check your internet and try again.</p>
        <button onclick="toggleCopilot()" class="btn btn-sm btn-outline-danger mt-3">Close</button>
      `;
    });
  }
  </script>

</body>
</html>
